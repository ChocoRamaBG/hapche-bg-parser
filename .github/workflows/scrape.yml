name: Infinite Scraper Grind üöÄ

on:
  workflow_dispatch:
  # –ú–æ–∂–µ—à –¥–∞ –≥–æ —Ä–∞–∑–∫–æ–º–µ–Ω—Ç–∏—Ä–∞—à, –∞–∫–æ –∏—Å–∫–∞—à –¥–∞ —Ç—Ä—ä–≥–≤–∞ —Å–∞–º
  # schedule:
  #   - cron: '0 0 * * *'

jobs:
  scrape-job:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      actions: write  # <--- –¢–û–í–ê –ï –í–ê–ñ–ù–û, –ó–ê –î–ê –ú–û–ñ–ï –î–ê –°–ï –†–ï–°–¢–ê–†–¢–ò–†–ê!

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          pip install webdriver-manager pandas selenium

      # --- –ü–£–°–ö–ê–ù–ï –ù–ê –°–ö–†–ò–ü–¢–ê ---
      # –ò–∑–ø–æ–ª–∑–≤–∞–º–µ "|| true" –∑–∞ –¥–∞ –Ω–µ —Å–ø—Ä–µ workflow-–∞ –∞–∫–æ —Å–∫—Ä–∏–ø—Ç—ä—Ç –≤—ä—Ä–Ω–µ exit code 2 (Restart)
      - name: Run Scraper Script
        id: scraper
        run: |
          python main.py
          echo "exit_code=$?" >> $GITHUB_OUTPUT
        continue-on-error: true 

      # --- –ó–ê–ü–ê–ó–í–ê–ù–ï –ù–ê LOOT-–ê ---
      - name: Commit Loot (Auto-Save)
        uses: stefanzweifel/git-auto-commit-action@v5
        if: always() 
        with:
          commit_message: "ü§ñ Save Progress: Page updated (Exit Code ${{ steps.scraper.outputs.exit_code }})"
          file_pattern: "last_page.txt scraped_data/*.csv" 
          skip_dirty_check: false

      # --- RESPAWN LOGIC (THE INFINITE LOOP) ---
      - name: Trigger Next Batch (Respawn)
        if: steps.scraper.outputs.exit_code == '2'  # <--- –ê–∫–æ —Å–∫—Ä–∏–ø—Ç—ä—Ç –∫–∞–∂–µ "2", —Ä–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞–º–µ
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "üîÑ Time limit hit. Respawning workflow for next batch..."
          gh workflow run scrape.yml
